/*
*******************************************************************************
*
*     Copyright (c) 2021 btlink Ltd.
*
*******************************************************************************
*  file name:           nv_default.c
*  author:              Eric
*  version:             1.00
*  file description:
*******************************************************************************
*  revision history:    date               version                  author
*
*  change summary:
*
*******************************************************************************
*/

/******************************************************************************
* Include Files
******************************************************************************/
#include "ctype.h"
#include <string.h>
#include <stdlib.h>
#include <stdio.h>
#include <stdarg.h>

#include "nv.h"
#include "btlink_nv.h"
#include "btlink_protocol_cmd.h"
/*****************************************************************************
* Define
*****************************************************************************/

/*****************************************************************************
* Typedef
*****************************************************************************/

/*****************************************************************************
* Extern Variable
*****************************************************************************/

/*****************************************************************************
* Extern Function
*****************************************************************************/

/*****************************************************************************
 * global variable
 *****************************************************************************/
btlink_config_ips_struct  nv_default_ips = 
{
	0x00,      /* Report Mode */
	0x01,      /* Buffer Mode */
	0x00,      /* Pri Mode */
	{          /* Pri HOST */
		0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
	},        
	{          
		0x00,    /* Socket Type */
		0x0000,  /* Address Length */
		0x0000,  /* port */
		{        /* IP Address */
			0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
			0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
		}  
	},
	0x00,      /* Sec Mode */
	{          /* Sec HOST */
		0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
	},         
	{      
		0x00,    /* Socket Type */
		0x0000,  /* Address Length */
		0x0000,  /* port */
		{        /* IP Address */
			0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
			0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
		}  
	}
};

btlink_config_apn_struct  nv_default_apn = 
{
	0x00,      /* apn_quantity */
	{          
		{0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},  /* MCC MNC 1 */
		{0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}   /* MCC MNC 2 */
	},
	
	{
		{        /* APN Name 1 */    
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
		},
		
		{        /* APN Name 2 */  
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
		}
	},
	
	{
		{        /* APN User Name 1 */    
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
		},
		
		{        /* APN User Name 2 */    
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
		}
	},
	
	{
		{        /* APN Password 1 */    
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
		},
		
		{        /* APN Password 2 */    
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
		}
	},
};

btlink_config_scs_struct  nv_default_scs = 
{
	{
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	},
	
	0x00000000
};

btlink_config_lss_struct  nv_default_lss = 
{
	0x00,           /* mode_selection */  
	0x0000,         /* continue_send_interval */  
	0x00,           /* start_mode */  
	{               /* spec_time_of_day */  
		0x00, 0x00, 0x00, 0x00, 0x00
	},
	0x00,           /* wakeup_interval */  
	0x00000000,     /* psm_net_hold_time */  
	0x00,           /* report_freq */ 
	0x00,           /* gnss_enable */ 
	0x00,           /* gnss_fix_delay */ 
	0x00,           /* agps_mode */ 
	0x00,           /* bat_low_percent */ 
	0x00,           /* sensor_enable */ 
	0x00            /* non_move_duration */ 
};
/*****************************************************************************
 * Local variable
 *****************************************************************************/

/*****************************************************************************
* Local function
*****************************************************************************/
void btlink_pro_nv_init(void)
{
	if (!nv_item_read("nv_bt_ips", (uint8_t *)&g_btlink_config.cfg_ips, sizeof(btlink_config_ips_struct)))
	{
		nv_item_write("nv_bt_ips", (uint8_t *)&nv_default_ips, sizeof(btlink_config_ips_struct));
		nv_item_read("nv_bt_ips", (uint8_t *)&g_btlink_config.cfg_ips, sizeof(btlink_config_ips_struct));
	}
	
	if (!nv_item_read("nv_bt_apn", (uint8_t *)&g_btlink_config.cfg_apn, sizeof(btlink_config_apn_struct)))
	{
		nv_item_write("nv_bt_apn", (uint8_t *)&nv_default_apn, sizeof(btlink_config_apn_struct));
		nv_item_read("nv_bt_apn", (uint8_t *)&g_btlink_config.cfg_apn, sizeof(btlink_config_apn_struct));
	}
	
	if (!nv_item_read("nv_bt_scs", (uint8_t *)&g_btlink_config.cfg_scs, sizeof(btlink_config_scs_struct)))
	{
		nv_item_write("nv_bt_scs", (uint8_t *)&nv_default_scs, sizeof(btlink_config_scs_struct));
		nv_item_read("nv_bt_scs", (uint8_t *)&g_btlink_config.cfg_scs, sizeof(btlink_config_scs_struct));
	}
	
	if (!nv_item_read("nv_bt_lss", (uint8_t *)&g_btlink_config.cfg_lss, sizeof(btlink_config_lss_struct)))
	{
		nv_item_write("nv_bt_lss", (uint8_t *)&nv_default_lss, sizeof(btlink_config_lss_struct));
		nv_item_read("nv_bt_lss", (uint8_t *)&g_btlink_config.cfg_lss, sizeof(btlink_config_lss_struct));
	}
}

void btlink_pro_nv_ips_write(void)
{
	nv_item_write("nv_bt_ips", (uint8_t *)&g_btlink_config.cfg_ips, sizeof(btlink_config_ips_struct));
}

void btlink_pro_nv_apn_write(void)
{
	nv_item_write("nv_bt_apn", (uint8_t *)&g_btlink_config.cfg_apn, sizeof(btlink_config_apn_struct));
}

void btlink_pro_nv_scs_write(void)
{
	nv_item_write("nv_bt_scs", (uint8_t *)&g_btlink_config.cfg_scs, sizeof(btlink_config_scs_struct));
}

void btlink_pro_nv_lss_write(void)
{
	nv_item_write("nv_bt_lss", (uint8_t *)&g_btlink_config.cfg_lss, sizeof(btlink_config_lss_struct));
}


